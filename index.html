<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <link rel="icon" type="image/x-icon" href="circle-256.ico" />
  <script data-goatcounter="https://oled.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
  <title>OLED - Keep Screen Awake</title>
  <style>
    :root { color-scheme: dark; }

    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      outline: none;
    }

    body.hide-cursor { cursor: none; }

    #dot {
      position: fixed;
      left: 0;
      top: 0;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: #ff7a00;
      opacity: 0;
      display: grid;
      place-items: center;
      transform: translate3d(0,0,0);
      will-change: transform, opacity;
      pointer-events: none;
      font-family: helvetica;
      font-size: 10px;
      font-weight: 7000;
      text-shadow: 0 0 0.0px #000, 0.4px 0 #000, -0.4px 0 #000, 0 0.4px #000, 0 -0.4px #000;
      color: #000;
      letter-spacing: 0.4px;
      transition: opacity 600ms ease;
    }

    body.boot #dot { transition: opacity 1800ms ease; }
    body.ready #dot { transition: opacity 600ms ease; }

    body.ready #dot { opacity: 0.9; }
    body.ready.active #dot { opacity: 0; }
    body.ready.active.show-dot #dot { opacity: 0.9; }

    #status {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      font-family: monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      text-align: center;
      transition: opacity 600ms ease;
    }

    #status.show { opacity: 0.9; }

    #status .main {
      font-size: 44px;
      letter-spacing: 2px;
    }

    #status .hint {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }

    #status .hint .primary {
      font-size: 16px;
      display: inline-block;
      margin-bottom: 16px;
      opacity: 0;
      transition: opacity 600ms ease;
    }

    #status.show .hint .primary { opacity: 1; }

    #status .countdown {
      margin-top: 10px;
      font-size: 18px;
      opacity: 0.4;
    }

    #toast {
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translate3d(-50%, 0, 0);
      font-family: monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      transition: opacity 600ms ease;
      text-align: center;
    }

    #toast.show { opacity: 0.9; }

    #toast .main {
      font-size: 12px;
      letter-spacing: 1px;
      opacity: 0.85;
    }

    .reserve {
      visibility: hidden;
      opacity: 0;
      transition: opacity 600ms ease;
    }

    .reveal {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body tabindex="0">

  <div id="dot">OFF</div>
  <div id="status"></div>
  <div id="toast"></div>

  <script>
    (function () {

      let wakeLock = null;
      let active = true;

      const dot = document.getElementById("dot");
      const statusEl = document.getElementById("status");
      const toastEl = document.getElementById("toast");

      const DOT_SIZE = 34;

      let animFrame = null;
      let lastTime = null;
      let vx = 0.02;
      let vy = 0.015;
      let x = 100;
      let y = 100;

      let countdownInterval = null;
      let introTimeout = null;
      let hideTimeout = null;
      let toastHide = null;

      const LS_KEY = "showDotOnActive";
      let showDotOnActive = (localStorage.getItem(LS_KEY) === "1");

      const CURSOR_IDLE_MS = 500;
      let cursorTimer = null;

      function showCursor() {
        document.body.classList.remove("hide-cursor");
      }

      function hideCursor() {
        document.body.classList.add("hide-cursor");
      }

      function resetCursorTimer() {
        showCursor();
        if (cursorTimer) clearTimeout(cursorTimer);
        cursorTimer = setTimeout(hideCursor, CURSOR_IDLE_MS);
      }

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function place(xPos, yPos) {
        dot.style.transform = "translate3d(" + xPos + "px," + yPos + "px, 0)";
      }

      function startDrift() {
        if (animFrame) return;

        x = rand(50, window.innerWidth - 50);
        y = rand(50, window.innerHeight - 50);

        vx = rand(-0.02, 0.02);
        vy = rand(-0.02, 0.02);

        lastTime = performance.now();

        function loop(now) {
          const dt = now - lastTime;
          lastTime = now;

          x += vx * dt;
          y += vy * dt;

          if (x <= 0 || x >= window.innerWidth - DOT_SIZE) vx *= -1;
          if (y <= 0 || y >= window.innerHeight - DOT_SIZE) vy *= -1;

          place(x, y);
          animFrame = requestAnimationFrame(loop);
        }

        animFrame = requestAnimationFrame(loop);
      }

      function stopDrift() {
        if (animFrame) cancelAnimationFrame(animFrame);
        animFrame = null;
      }

      function stopCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        countdownInterval = null;
      }

      function clearOverlayTimers() {
        if (introTimeout) clearTimeout(introTimeout);
        if (hideTimeout) clearTimeout(hideTimeout);
        introTimeout = null;
        hideTimeout = null;
        stopCountdown();
      }

      function fadeInOverlay() {
        statusEl.classList.remove("show");
        requestAnimationFrame(() => statusEl.classList.add("show"));
      }

      function fadeOutOverlay() {
        statusEl.classList.remove("show");
      }

      function setOverlayHtmlWithFade(html) {
        clearOverlayTimers();

        fadeOutOverlay();
        setTimeout(() => {
          statusEl.innerHTML = html;
          fadeInOverlay();
        }, 100);
      }

      function applyDotMode(skipDriftReset) {
        if (!active) {
          dot.textContent = "OFF";
          document.body.classList.remove("show-dot");

          if (!animFrame && !skipDriftReset) startDrift();
          return;
        }

        if (showDotOnActive) {
          dot.textContent = "ON";
          document.body.classList.add("show-dot");

          if (!animFrame) startDrift();
        } else {
          dot.textContent = "ON";
          document.body.classList.remove("show-dot");
          stopDrift();
        }
      }

      function progressiveIntro() {
        clearOverlayTimers();

        statusEl.innerHTML = `
          <div class="main reserve" id="activeText">ACTIVE</div>
          <div class="hint">
            <span class="primary">Keeps your OLED screen awake</span><br>
            <span class="reserve" id="restHint">
              Space or click = toggle<br>
              F = fullscreen<br>
              V = dot on/off<br>
              <div class="countdown" id="c">3</div>
            </span>
          </div>
        `;

        fadeInOverlay();

        introTimeout = setTimeout(() => {
          const activeText = document.getElementById("activeText");
          const restHint = document.getElementById("restHint");

          if (activeText) activeText.classList.add("reveal");
          if (restHint) restHint.classList.add("reveal");

          let t = 3;
          const c = document.getElementById("c");
          if (c) c.textContent = t;

          countdownInterval = setInterval(() => {
            const cc = document.getElementById("c");
            if (!cc) return stopCountdown();
            t--;
            cc.textContent = t;
            if (t <= 0) stopCountdown();
          }, 1000);

          hideTimeout = setTimeout(() => {
            fadeOutOverlay();
          }, 3000);

        }, 2000);
      }

      function showToggleState(text) {
        toastEl.classList.remove("show");

        setOverlayHtmlWithFade(`<div class="main">${text}</div>`);

        hideTimeout = setTimeout(() => {
          fadeOutOverlay();
        }, 600);
      }

      function showTinyToast(text) {
        if (toastHide) clearTimeout(toastHide);

        toastEl.innerHTML = `<div class="main">${text}</div>`;
        toastEl.classList.add("show");

        toastHide = setTimeout(() => {
          toastEl.classList.remove("show");
        }, 600);
      }

      async function requestLock() {
        if (!navigator.wakeLock) return false;
        try {
          wakeLock = await navigator.wakeLock.request("screen");
          return true;
        } catch {
          return false;
        }
      }

      async function releaseLock() {
        if (wakeLock) await wakeLock.release();
        wakeLock = null;
      }

      async function setActive(state) {
        active = state;
        document.body.classList.toggle("active", active);

        if (active) {
          showToggleState("ACTIVE");
          await requestLock();
        } else {
          showToggleState("DEACTIVATED");
          await releaseLock();
        }

        applyDotMode();
      }

      function toggleDotOnActive() {
        showDotOnActive = !showDotOnActive;
        localStorage.setItem(LS_KEY, showDotOnActive ? "1" : "0");

        applyDotMode(true);
        showTinyToast(showDotOnActive ? "DOT ON" : "DOT OFF");
      }

      async function toggleFullscreen() {
        try {
          if (document.fullscreenElement) {
            await document.exitFullscreen();
          } else {
            await document.documentElement.requestFullscreen();
          }
        } catch (_) {}
      }

      document.addEventListener("mousemove", resetCursorTimer, { passive: true });

      document.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        resetCursorTimer();
        setActive(!active);
      });

      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          resetCursorTimer();
          setActive(!active);
          return;
        }

        if (e.key === "f" || e.key === "F") {
          e.preventDefault();
          resetCursorTimer();
          toggleFullscreen();
          return;
        }

        if (e.key === "v" || e.key === "V") {
          e.preventDefault();
          resetCursorTimer();
          toggleDotOnActive();
        }
      });

      (async function init() {
        document.body.classList.toggle("active", active);

        applyDotMode(true);
        progressiveIntro();

        document.body.classList.add("boot");

        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            document.body.classList.add("ready");
            setTimeout(() => document.body.classList.remove("boot"), 1000);
          });
        });

        resetCursorTimer();

        await requestLock();
      })();

    })();
  </script>
</body>
</html>