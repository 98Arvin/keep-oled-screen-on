<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <link rel="icon" type="image/x-icon" href="circle-256.ico" />
  <script data-goatcounter="https://oled.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
  <title>OLED - Keep Screen Awake</title>
  <style>
    :root { color-scheme: dark; }

    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      outline: none;
      cursor: default;
    }

    body.cursor-hidden { cursor: none; }

    body.dim { filter: brightness(0.25); transition: filter 600ms ease; }

    #dot {
      position: fixed;
      left: 0;
      top: 0;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: #ff7a00;
      opacity: 0;
      display: grid;
      place-items: center;
      transform: translate3d(0,0,0);
      will-change: transform, opacity;
      pointer-events: none;
      font-family: helvetica;
      font-size: 10px;
      font-weight: 7000;
      text-shadow: 0 0 0.0px #000, 0.4px 0 #000, -0.4px 0 #000, 0 0.4px #000, 0 -0.4px #000;
      color: #000;
      letter-spacing: 0.4px;
      transition: opacity 600ms ease;
    }

    body.boot #dot { transition: opacity 1800ms ease; }
    body.ready #dot { transition: opacity 600ms ease; }

    body.ready #dot { opacity: 0.9; }
    body.ready.active #dot { opacity: 0; }
    body.ready.active.show-dot #dot { opacity: 0.9; }

    #status {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      font-family: monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      text-align: center;
      transition: opacity 600ms ease;
    }

    #status.show { opacity: 0.9; }

    #status .main {
      font-size: 44px;
      letter-spacing: 2px;
    }

    #status .hint {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }

    #status .hint .primary {
      font-size: 16px;
      display: inline-block;
      margin-bottom: 16px;
      opacity: 0;
      transition: opacity 600ms ease;
    }

    #status.show .hint .primary { opacity: 1; }

    #status .countdown {
      margin-top: 10px;
      font-size: 18px;
      opacity: 0.4;
    }

    #toast {
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translate3d(-50%, 0, 0);
      font-family: monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      transition: opacity 600ms ease;
      text-align: center;
    }

    #toast.show { opacity: 0.9; }

    #toast .main {
      font-size: 12px;
      letter-spacing: 1px;
      opacity: 0.85;
    }

    .reserve {
      visibility: hidden;
      opacity: 0;
      transition: opacity 600ms ease;
    }

    .reveal {
      visibility: visible;
      opacity: 1;
    }

    /* hold-to-toggle ring */
    #hold {
      position: fixed;
      left: 0;
      top: 0;
      width: 56px;
      height: 56px;
      transform: translate3d(-9999px,-9999px,0);
      opacity: 0;
      pointer-events: none;
      transition: opacity 150ms ease;
      will-change: transform, opacity;
    }

    #hold.show { opacity: 0.9; }

    #hold svg {
      width: 56px;
      height: 56px;
      display: block;
      transform: rotate(-90deg);
      filter: drop-shadow(0 0 0.25px rgba(0,0,0,0.6));
    }

    #hold .bg {
      fill: none;
      stroke: rgba(255, 122, 0, 0.18);
      stroke-width: 5;
    }

    #hold .fg {
      fill: none;
      stroke: #ff7a00;
      stroke-width: 5;
      stroke-linecap: round;
      stroke-dasharray: 1 999;
      stroke-dashoffset: 0;
    }
  </style>
</head>
<body tabindex="0">

  <div id="dot">OFF</div>
  <div id="status"></div>
  <div id="toast"></div>

  <div id="hold" aria-hidden="true">
    <svg viewBox="0 0 56 56">
      <circle class="bg" cx="28" cy="28" r="20"></circle>
      <circle class="fg" cx="28" cy="28" r="20"></circle>
    </svg>
  </div>

  <script>
    (function () {

      const CURSOR_IDLE_MS = 500;
      const HOLD_MS = 700;
      const HINT_SHOW_MS = 3000;

      let wakeLock = null;
      let active = true;

      const dot = document.getElementById("dot");
      const statusEl = document.getElementById("status");
      const toastEl = document.getElementById("toast");

      const holdEl = document.getElementById("hold");
      const holdFg = holdEl.querySelector(".fg");

      const DOT_SIZE = 34;

      let animFrame = null;
      let lastTime = null;
      let vx = 0.02;
      let vy = 0.015;
      let x = 100;
      let y = 100;

      let countdownInterval = null;
      let introTimeout = null;
      let hideTimeout = null;
      let toastHide = null;

      const LS_KEY = "showDotOnActive";
      let showDotOnActive = (localStorage.getItem(LS_KEY) ?? "1") === "1";

      const LS_DIM_KEY = "dimMode";
      let dimMode = (localStorage.getItem(LS_DIM_KEY) ?? "0") === "1";

      let cursorTimer = null;

      let holding = false;
      let holdRAF = null;
      let holdStart = 0;
      let holdDone = false;

      const R = 20;
      const CIRC = 2 * Math.PI * R;

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function place(xPos, yPos) {
        dot.style.transform = "translate3d(" + xPos + "px," + yPos + "px, 0)";
      }

      function startDrift() {
        if (animFrame) return;

        x = rand(50, window.innerWidth - 50);
        y = rand(50, window.innerHeight - 50);

        vx = rand(-0.02, 0.02);
        vy = rand(-0.02, 0.02);

        lastTime = performance.now();

        function loop(now) {
          const dt = now - lastTime;
          lastTime = now;

          x += vx * dt;
          y += vy * dt;

          if (x <= 0 || x >= window.innerWidth - DOT_SIZE) vx *= -1;
          if (y <= 0 || y >= window.innerHeight - DOT_SIZE) vy *= -1;

          place(x, y);
          animFrame = requestAnimationFrame(loop);
        }

        animFrame = requestAnimationFrame(loop);
      }

      function stopDrift() {
        if (animFrame) cancelAnimationFrame(animFrame);
        animFrame = null;
      }

      function stopCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        countdownInterval = null;
      }

      function clearOverlayTimers() {
        if (introTimeout) clearTimeout(introTimeout);
        if (hideTimeout) clearTimeout(hideTimeout);
        introTimeout = null;
        hideTimeout = null;
        stopCountdown();
      }

      function fadeInOverlay() {
        statusEl.classList.remove("show");
        requestAnimationFrame(() => statusEl.classList.add("show"));
      }

      function fadeOutOverlay() {
        statusEl.classList.remove("show");
      }

      function setOverlayHtmlWithFade(html) {
        clearOverlayTimers();

        fadeOutOverlay();
        setTimeout(() => {
          statusEl.innerHTML = html;
          fadeInOverlay();
        }, 100);
      }

      function applyDotMode(skipDriftReset) {
        if (!active) {
          dot.textContent = "OFF";
          document.body.classList.remove("show-dot");

          if (!animFrame && !skipDriftReset) startDrift();
          return;
        }

        if (showDotOnActive) {
          dot.textContent = "ON";
          document.body.classList.add("show-dot");

          if (!animFrame) startDrift();
        } else {
          dot.textContent = "ON";
          document.body.classList.remove("show-dot");
          stopDrift();
        }
      }

      function renderHintOverlay() {
        statusEl.innerHTML = `
          <div class="main reserve" id="activeText">ACTIVE</div>
          <div class="hint">
            <span class="primary">Keeps your OLED screen awake</span><br>
            <span class="reserve" id="restHint">
              Hold click = toggle<br>
              Space = toggle<br>
              F = fullscreen<br>
              V = dot on/off<br>
              H = hint<br>
              D = dim<br>
              <div class="countdown" id="c">3</div>
            </span>
          </div>
        `;
      }

      function showHintFor(ms) {
        clearOverlayTimers();

        renderHintOverlay();
        fadeInOverlay();

        introTimeout = setTimeout(() => {
          const activeText = document.getElementById("activeText");
          const restHint = document.getElementById("restHint");

          if (activeText) activeText.classList.add("reveal");
          if (restHint) restHint.classList.add("reveal");

          let t = 3;
          const c = document.getElementById("c");
          if (c) c.textContent = t;

          countdownInterval = setInterval(() => {
            const cc = document.getElementById("c");
            if (!cc) return stopCountdown();
            t--;
            cc.textContent = t;
            if (t <= 0) stopCountdown();
          }, 1000);

          hideTimeout = setTimeout(() => {
            fadeOutOverlay();
          }, ms);

        }, 2000);
      }

      function progressiveIntro() {
        showHintFor(HINT_SHOW_MS);
      }

      function showToggleState(text) {
        toastEl.classList.remove("show");

        setOverlayHtmlWithFade(`<div class="main">${text}</div>`);

        hideTimeout = setTimeout(() => {
          fadeOutOverlay();
        }, 600);
      }

      function showTinyToast(text) {
        if (toastHide) clearTimeout(toastHide);

        toastEl.innerHTML = `<div class="main">${text}</div>`;
        toastEl.classList.add("show");

        toastHide = setTimeout(() => {
          toastEl.classList.remove("show");
        }, 600);
      }

      async function requestLock() {
        if (!navigator.wakeLock) return false;
        try {
          wakeLock = await navigator.wakeLock.request("screen");
          return true;
        } catch {
          return false;
        }
      }

      async function releaseLock() {
        if (wakeLock) await wakeLock.release();
        wakeLock = null;
      }

      async function setActive(state) {
        active = state;
        document.body.classList.toggle("active", active);

        if (active) {
          showToggleState("ACTIVE");
          await requestLock();
        } else {
          showToggleState("DEACTIVATED");
          await releaseLock();
        }

        applyDotMode();
      }

      function toggleDotOnActive() {
        showDotOnActive = !showDotOnActive;
        localStorage.setItem(LS_KEY, showDotOnActive ? "1" : "0");

        applyDotMode(true);
        showTinyToast(showDotOnActive ? "DOT ON" : "DOT OFF");
      }

      function toggleDim() {
        dimMode = !dimMode;
        localStorage.setItem(LS_DIM_KEY, dimMode ? "1" : "0");
        document.body.classList.toggle("dim", dimMode);
        showTinyToast(dimMode ? "DIM ON" : "DIM OFF");
      }

      async function toggleFullscreen() {
        try {
          if (document.fullscreenElement) {
            await document.exitFullscreen();
          } else {
            await document.documentElement.requestFullscreen();
          }
        } catch (_) {}
      }

      function showHoldAt(clientX, clientY) {
        holdEl.style.transform = "translate3d(" + clientX + "px," + clientY + "px,0) translate3d(-50%,-50%,0)";
        holdEl.classList.add("show");
        holdFg.style.strokeDasharray = CIRC + " " + CIRC;
        holdFg.style.strokeDashoffset = String(CIRC);
      }

      function hideHold() {
        holdEl.classList.remove("show");
        holdEl.style.transform = "translate3d(-9999px,-9999px,0)";
      }

      function stopHoldLoop() {
        if (holdRAF) cancelAnimationFrame(holdRAF);
        holdRAF = null;
      }

      function startHoldLoop() {
        stopHoldLoop();
        holdDone = false;

        function tick(now) {
          if (!holding) return;

          const elapsed = now - holdStart;
          const p = Math.max(0, Math.min(1, elapsed / HOLD_MS));
          holdFg.style.strokeDashoffset = String(CIRC * (1 - p));

          if (p >= 1 && !holdDone) {
            holdDone = true;
            holding = false;
            hideHold();
            setActive(!active);
            return;
          }

          holdRAF = requestAnimationFrame(tick);
        }

        holdRAF = requestAnimationFrame(tick);
      }

      function onUserActivity() {
        document.body.classList.remove("cursor-hidden");
        if (cursorTimer) clearTimeout(cursorTimer);
        cursorTimer = setTimeout(() => {
          document.body.classList.add("cursor-hidden");
        }, CURSOR_IDLE_MS);
      }

      document.addEventListener("pointerdown", (e) => {
        if (e.button !== 0) return;
        e.preventDefault();

        onUserActivity();

        holding = true;
        holdStart = performance.now();
        showHoldAt(e.clientX, e.clientY);
        startHoldLoop();
      });

      document.addEventListener("pointermove", (e) => {
        onUserActivity();
        if (holding) {
          showHoldAt(e.clientX, e.clientY);
        }
      });

      document.addEventListener("pointerup", (e) => {
        if (e.button !== 0) return;
        e.preventDefault();

        onUserActivity();

        if (!holding) return;
        holding = false;
        stopHoldLoop();
        hideHold();
      });

      document.addEventListener("pointercancel", () => {
        if (!holding) return;
        holding = false;
        stopHoldLoop();
        hideHold();
      });

      document.addEventListener("visibilitychange", async () => {
        if (document.visibilityState === "visible" && active) {
          await requestLock();
        }
      });

      document.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        onUserActivity();
        showHintFor(HINT_SHOW_MS);
      });

      document.addEventListener("keydown", (e) => {
        onUserActivity();

        if (e.code === "Space") {
          e.preventDefault();
          setActive(!active);
          return;
        }

        if (e.key === "d" || e.key === "D") {
          e.preventDefault();
          toggleDim();
          return;
        }

        if (e.key === "f" || e.key === "F") {
          e.preventDefault();
          toggleFullscreen();
          return;
        }

        if (e.key === "v" || e.key === "V") {
          e.preventDefault();
          toggleDotOnActive();
          return;
        }

        if (e.key === "h" || e.key === "H") {
          e.preventDefault();
          showHintFor(HINT_SHOW_MS);
          return;
        }
      });

      (async function init() {
        document.body.classList.toggle("active", active);
        document.body.classList.toggle("dim", dimMode);

        applyDotMode(true);
        progressiveIntro();

        document.body.classList.add("boot");

        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            document.body.classList.add("ready");
            setTimeout(() => document.body.classList.remove("boot"), 1000);
          });
        });

        onUserActivity();
        await requestLock();
      })();

    })();
  </script>
</body>
</html>