<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <script data-goatcounter="https://98arvin.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
  <title>Stay Awake - OLED</title>
  <style>
    :root { color-scheme: dark; }

    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      outline: none;
    }

    /* dot = OFF */
    #dot {
      position: fixed;
      left: 0;
      top: 0;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: #ff7a00;
      opacity: 0.9;
      display: grid;
      place-items: center;
      transform: translate3d(0,0,0);
      will-change: transform;
      pointer-events: none;
      font-family: helvetica;
      font-size: 10px;
      font-weight: 7000;
      text-shadow: 0 0 0.0px #000, 0.4px 0 #000, -0.4px 0 #000, 0 0.4px #000, 0 -0.4px #000;
      color: #000;
      letter-spacing: 0.4px;
    }

    body.active #dot {
      display: none;
    }

    /* overlay */
    #status {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      font-family: monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      transition: opacity 120ms linear;
      text-align: center;
    }

    #status.show { opacity: 0.9; }

    #status .main {
      font-size: 44px;
      letter-spacing: 2px;
    }

    #status .hint {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }

    #status .countdown {
      margin-top: 6px;
      opacity: 0.6;
    }
  </style>
</head>
<body tabindex="0">

  <div id="dot">OFF</div>
  <div id="status"></div>

  <script>
    (function () {

      let wakeLock = null;
      let active = true;

      const dot = document.getElementById("dot");
      const statusEl = document.getElementById("status");

      const DOT_SIZE = 34;

      let animFrame = null;
      let lastTime = null;
      let vx = 0.02;
      let vy = 0.015;
      let x = 100;
      let y = 100;

      let timer = null;

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function place(xPos, yPos) {
        dot.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
      }

      function startDrift() {
        stopDrift();

        x = rand(50, window.innerWidth - 50);
        y = rand(50, window.innerHeight - 50);

        vx = rand(-0.02, 0.02);
        vy = rand(-0.02, 0.02);

        lastTime = performance.now();

        function loop(now) {
          const dt = now - lastTime;
          lastTime = now;

          x += vx * dt;
          y += vy * dt;

          if (x <= 0 || x >= window.innerWidth - DOT_SIZE) vx *= -1;
          if (y <= 0 || y >= window.innerHeight - DOT_SIZE) vy *= -1;

          place(x, y);

          animFrame = requestAnimationFrame(loop);
        }

        animFrame = requestAnimationFrame(loop);
      }

      function stopDrift() {
        if (animFrame) cancelAnimationFrame(animFrame);
        animFrame = null;
      }

      function showStatus(text, hint) {
        if (timer) clearTimeout(timer);

        statusEl.innerHTML = `
          <div class="main">${text}</div>
          ${hint ? `
            <div class="hint">
              Click = toggle<br>
              Space / F = fullscreen
              <div class="countdown" id="c">5</div>
            </div>` : ''}
        `;

        statusEl.classList.add("show");

        if (hint) {
          let t = 5;
          const c = document.getElementById("c");

          const i = setInterval(() => {
            t--;
            if (c) c.textContent = t;
            if (t <= 0) clearInterval(i);
          }, 1000);
        }

        timer = setTimeout(() => {
          statusEl.classList.remove("show");
        }, hint ? 5000 : 2000);
      }

      async function requestLock() {
        if (!navigator.wakeLock) return false;
        try {
          wakeLock = await navigator.wakeLock.request("screen");
          return true;
        } catch {
          return false;
        }
      }

      async function releaseLock() {
        if (wakeLock) await wakeLock.release();
        wakeLock = null;
      }

      async function setActive(state) {
        active = state;
        document.body.classList.toggle("active", active);

        if (active) {
          stopDrift();
          showStatus("ACTIVE", false);
          await requestLock();
        } else {
          showStatus("DEACTIVATED", false);
          await releaseLock();
          startDrift();
        }
      }

      document.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        setActive(!active);
      });

      document.addEventListener("keydown", (e) => {
        if (e.code === "Space" || e.key === "f" || e.key === "F") {
          e.preventDefault();
          document.fullscreenElement
            ? document.exitFullscreen()
            : document.documentElement.requestFullscreen();
        }
      });

      (async function init() {
        document.body.classList.toggle("active", active);
        showStatus("ACTIVE", true);
        await requestLock();
      })();

    })();
  </script>
</body>
</html>