<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <script data-goatcounter="https://98arvin.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
  <title>Keep Awake - OLED</title>
  <style>
    :root { color-scheme: dark; }
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      outline: none;
    }

    #dot {
      position: fixed;
      left: 0;
      top: 0;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #ff7a00;
      opacity: 0.9;
      transform: translate3d(0,0,0);
      will-change: transform;
      pointer-events: none;
    }
    body.active #dot { display: none; }

    /* Status overlay */
    #status {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: #ff7a00;
      opacity: 0;
      pointer-events: none;
      transition: opacity 120ms linear;
      text-align: center;
    }
    #status.show { opacity: 0.9; }

    #status .main {
      font-size: 44px;
      letter-spacing: 2px;
      line-height: 1.05;
    }
    #status .hint {
      margin-top: 10px;
      font-size: 12px;
      letter-spacing: 0.6px;
      opacity: 0.75;
    }
    #status .hint .countdown {
      display: block;
      margin-top: 6px;
      opacity: 0.7;
    }

    #sr {
      position: fixed;
      width: 1px;
      height: 1px;
      left: -9999px;
      top: -9999px;
    }
  </style>
</head>
<body tabindex="0">
  <div id="dot" aria-hidden="true"></div>
  <div id="status" aria-hidden="true"></div>
  <div id="sr">Click to toggle. Press Space or F to toggle fullscreen.</div>

  <script>
    (function () {
      let wakeLock = null;
      let active = true; // Active on launch

      const dot = document.getElementById('dot');
      const statusEl = document.getElementById('status');
      const DOT_SIZE = 30;
      let statusTimer = null;

      function randInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function placeDotRandomly() {
        const margin = 16;
        const w = Math.max(1, window.innerWidth);
        const h = Math.max(1, window.innerHeight);

        const xMax = Math.max(margin, w - margin - DOT_SIZE);
        const yMax = Math.max(margin, h - margin - DOT_SIZE);

        const x = randInt(margin, xMax);
        const y = randInt(margin, yMax);

        dot.style.transform = 'translate3d(' + x + 'px,' + y + 'px,0)';
      }

      function showStatus(text, showHint) {
        if (statusTimer) clearTimeout(statusTimer);
        if (showStatus._countdownTimer) clearInterval(showStatus._countdownTimer);

        if (showHint) {
          statusEl.innerHTML =
            '<div class="main">' + text + '</div>' +
            '<div class="hint">' +
              'Click anywhere = toggle<br>Space / F = fullscreen<br>' +
              '<span class="countdown">Fading in <span id="countdownSec">5</span>s</span>' +
            '</div>';
        } else {
          statusEl.innerHTML = '<div class="main">' + text + '</div>';
        }

        statusEl.classList.add('show');

        const durationMs = showHint ? 5000 : 2000;

        if (showHint) {
          let remaining = Math.ceil(durationMs / 1000);
          const secEl = document.getElementById('countdownSec');

          showStatus._countdownTimer = setInterval(() => {
            remaining -= 1;
            if (secEl) secEl.textContent = String(Math.max(0, remaining));
            if (remaining <= 0) {
              clearInterval(showStatus._countdownTimer);
              showStatus._countdownTimer = null;
            }
          }, 1000);
        }

        statusTimer = setTimeout(() => {
          statusEl.classList.remove('show');
          if (showStatus._countdownTimer) {
            clearInterval(showStatus._countdownTimer);
            showStatus._countdownTimer = null;
          }
        }, durationMs);
      }

      async function requestWakeLock() {
        if (!('wakeLock' in navigator) || !navigator.wakeLock) return;
        try {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeLock.addEventListener('release', () => { wakeLock = null; });
        } catch (_) {
          wakeLock = null;
        }
      }

      async function releaseWakeLock() {
        if (!wakeLock) return;
        try {
          await wakeLock.release();
        } catch (_) {
        } finally {
          wakeLock = null;
        }
      }

      async function setActive(next) {
        active = next;
        document.body.classList.toggle('active', active);

        if (active) {
          showStatus('ACTIVE', false);
          await requestWakeLock();
        } else {
          showStatus('DEACTIVATED', false);
          await releaseWakeLock();
          placeDotRandomly();
        }
      }

      async function toggleActive() {
        await setActive(!active);
      }

      // Click anywhere toggles active/inactive
      document.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        toggleActive();
      }, { passive: false });

      // Re-assert wake lock when returning to the page
      document.addEventListener('visibilitychange', async () => {
        if (!active) return;
        if (document.visibilityState !== 'visible') return;
        if (wakeLock) return;
        await requestWakeLock();
      });

      window.addEventListener('resize', () => {
        if (!active) placeDotRandomly();
      });

      async function toggleFullscreen() {
        try {
          if (document.fullscreenElement) {
            await document.exitFullscreen();
          } else {
            await document.documentElement.requestFullscreen({ navigationUI: 'hide' });
          }
        } catch (_) {}
      }

      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.key === ' ' || e.code === 'KeyF' || e.key === 'f' || e.key === 'F') {
          e.preventDefault();
          toggleFullscreen();
        }
      }, { passive: false });

      window.addEventListener('click', () => {
        try { document.body.focus(); } catch (_) {}
      });

      // Init: active by default + always show ACTIVE + hint on load
      (async function init() {
        document.body.classList.toggle('active', active);
        try { document.body.focus(); } catch (_) {}

        showStatus('ACTIVE', true);
        await requestWakeLock();
      })();
    })();
  </script>
</body>
</html>